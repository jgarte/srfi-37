<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN"><html><head>
<html>
<head>
<title>SRFI 37: args-fold: a program argument processor</title>
</head>
<body>

<H1>Title</H1>

args-fold: a program argument processor

<H1>Author</H1>

Anthony Carrico

<h1>Status</h1>
in ``final'' status

<h1>Abstract</h1>

<p>Many operating systems make the set of argument strings used to invoke a program available (often following the program name string in an array called argv). Most programs need to parse and process these argument strings in one way or another. This SRFI describes a set of procedures that support processing program arguments according to POSIX and GNU C Library Reference Manual guidelines.</p>

<h1>Issues</h1>

<p>This SRFI does not address how to obtain the program arguments from the operating system (but maybe it should).</p>

<p>This SRFI does not address long option abbreviations. Presumably some implementations might support such abbreviations (as an optional extension), but it is also debatable if long argument abbreviations are desirable, so they are not included in this SRFI.</p>

<p>As usual when folding multiple values, zero seeds produces zero results, which requires a continuation accepting zero values. (It might be desirable for this SRFI to point out this pitfall to beginners.)</p>

<p>Should the NAME argument of an option-processor be eq? or equal? to one of the OPTION's option-names. Probably eq?: fix the reference implementation.

<h1>Rationale</h1>

<p>Program arguments are the primary interface to many programs, so processing arguments is a common programming task. There are many common (often conflicting) ways take care of this task, so a custom processor is often necessary; however, many programmers (and their users) would welcome a convenient interface supporting common guidelines.</p>

<p>POSIX provides several <a href="http://www.opengroup.org/onlinepubs/007904975/basedefs/xbd_chap12.html#tag_12_02">guidelines</a> for the specification of program options, option-arguments, and operands. It also notes historical exceptions to these guidelines. The GNU C Library Reference Manual <a href="http://www.gnu.org/manual/glibc/html_node/Argument-Syntax.html">describes</a> long option extensions to the POSIX guidelines.</p>

<p>This SRFI supports creating programs following the guidelines mentioned above by
<ul>
  <li>parsing short-options and long-options in any order and possibly repeated,</li>
  <li>option-arguments (possibly required or forbidden),</li>
  <li>operands (non-option argument strings),</li>
  <li>and recognizing option processing termination.</li>
</ul>
It parses argument strings according to the following rules:</p>

<ul>
  <li>Each short-option name is a single character.</li>
  <li>One or more short-options are accepted in a single argument string when grouped behind one <b>-</b> delimiter character. Examples: <b>-a -bcd</b></i></li>
  <li>A short-option-argument is accepted in a separate argument string immediately following a short-option. Examples: <b>-a foo -bcd bar</b></li>
  <li>Also (for historical reasons) a short-option-argument is accepted immediately following the last short-option in a single argument string. Examples: <b>-afoo -bcdbar</b></li>
  <li>Each long-option name is one or more characters.</li>
  <li>One long-option is accepted in a single argument string when preceded by two <b>-</b> delimiter characters. Example: <b>--help</b></li>
  <li>In a single argument string, a long-option followed by one <b>=</b> delimiter character followed by a long-option-argument is accepted. Example: <b>--speed=fast</b></li>
  <li>The first <b>--</b> argument string is accepted as a delimiter indicating the end of options. It is not treated as an option or an operand. Any argument strings following this delimiter are treated as operands, even if they begin with the <b>-</b> character.</li>
  <li>All other argument strings are treated as operands. This includes argument strings consisting of a single <b>-</b> character.</li>
  <li>Operands may be intermingled with options in any order.</li>
</ul>

<p>Preliminary versions of this interface are already available for some Scheme implementations: <a href="http://www.call-with-current-continuation.org/manual.html#script-utils">here</a> for Chicken, and <a href="http://www.scsh.net/resources/getopt.html">here</a> for Scsh.</p>

<h1>Specification</h1>

<p>Args-fold is an iterator similar to SRFI 1's fold procedure ("the fundamental list iterator"). As it parses options and operands, it calls their corresponding operand and option processors. Unlike mapping, folding passes state, called seeds, from one processor to the next.</p>

<p>For example, a program may need a list of operands and a table of options. To build these, args-fold could be seeded with an empty operand list, and an empty option table. The operand processor could add the operands to the operand list, and the option processors could add the options to the option table. Along the way, some option processors might even take immediate action for options like <i>--version</i> or <i>--help</i>. This kind of heterogeneous processing is appropriate for program arguments, and folding allows a functional implementation if desired.</p>

<pre>procedure prototype: (option-processor OPTION NAME ARG SEEDS ...)</pre>

<p>Prototype for an option-processor. It should return the next seeds as values. OPTION will be the option. NAME will be one of the OPTION's option-names as encountered by args-fold. ARG will be a string, or #f if args-fold didn't encounter an option-argument.</p>

<pre>procedure prototype: (operand-processor OPERAND SEEDS ...)</pre>

<p>Prototype for an operand-processor. It should return the next seeds as values. OPERAND will be a string.</p>

<pre>procedure: (option NAMES REQUIRED-ARG? OPTIONAL-ARG? OPTION-PROC)</pre>

<p>Return an option. NAMES is a list of short (character) and long (string) option names. REQUIRED-ARG? specifies if this options requires an option-argument (boolean). OPTIONAL-ARG? specifies if this option can accept an option-argument (boolean). OPTION-PROC is a procedure (following the option-processor prototype) used to process this option.</p>

<pre>
procedure: (option-names OPTION)
procedure: (option-required-arg? OPTION)
procedure: (option-optional-arg? OPTION)
procedure: (option-processor OPTION)
</pre>

<p>Return the contents of corresponding fields of OPTION.</p>

<pre>procedure: (args-fold ARGS OPTIONS UNRECOGNIZED-OPTION-PROC OPERAND-PROC SEEDS ...)</pre>

<p>Parse argument strings left-to-right, calling the appropriate processors in-order (for the parsed known options, unknown options, and operands), passing the seed values from one processor to the next and returning the final seeds values as results. ARGS is a list of strings. OPTIONS is a list of options. UNRECOGNIZED-OPTION-PROC is a procedure (following the option-processor prototype) for unrecognized options. NOTE: args-fold will create temporary options as necessary for the UNRECOGNIZED-OPTION-PROC. OPERAND-PROC is a procedure (following the operand-processor prototype) for operands.</p>

<a href="http://srfi.schemers.org/srfi-37-reference.scm">Source for the reference implementation.</a>

<h1>Copyright</h1>
Copyright (C) Anthony Carrico (2002). All Rights Reserved.
<p>
This document and translations of it may be copied and furnished to
others, and derivative works that comment on or otherwise explain it
or assist in its implementation may be prepared, copied, published and
distributed, in whole or in part, without restriction of any kind,
provided that the above copyright notice and this paragraph are
included on all such copies and derivative works. However, this
document itself may not be modified in any way, such as by removing
the copyright notice or references to the Scheme Request For
Implementation process or editors, except as needed for the purpose of
developing SRFIs in which case the procedures for copyrights defined
in the SRFI process must be followed, or as required to translate it
into languages other than English.
</p><p>
The limited permissions granted above are perpetual and will not be
revoked by the authors or their successors or assigns.
</p><p>
This document and the information contained herein is provided on an
"AS IS" basis and THE AUTHOR AND THE SRFI EDITORS DISCLAIM ALL
WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY
WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY
RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A
PARTICULAR PURPOSE.


    </p><hr>
    <address>Editor: <a href="mailto:srfi-editors@srfi.schemers.org">??? ?????</a></address>
  </body></html>
